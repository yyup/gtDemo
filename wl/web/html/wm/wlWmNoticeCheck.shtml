<!DOCTYPE html >
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title></title>
<script src="../../js/jquery.min.js"></script>
<script language="javascript" src="../../js/prj/cLodopFuncs.js"></script> 
<script src="../../js/joy.loader.js" modules="form,dataview,advgrid,layout,editor"></script>
<link rel="stylesheet" type="text/css" href="../../style/prj/wl.common.css" />
<link rel="stylesheet" type="text/css" href="../../style/prj/wm.wlWmNoticeCheck.css" />

</head>
<body>

	<!-- 搜索栏 -->
	<div class="searchContent">
		<div class="searchContent_l">
			<button class="joy-button joy-smc" icon="plus" onClick="openAdd"
				 label="lgc:add" databind="visible:INPUTSmc"></button>
			<button class="joy-button joy-smc" icon="close" onClick="deleteData"
				 label="lgc:delete" databind="visible:INPUTSmc"></button>
			<button class="joy-button joy-smc" icon="seek-s" onClick="issue"
				label="lg:issued" databind="visible:AUDITSmc"></button>
			<button class="joy-button joy-smc" icon="cancel" onClick="cancel"
				label="lg:cancel" databind="visible:AUDITSmc"></button>
		</div>
		<div class="searchContent_r">
			<div class="fit1024" style="float: left; padding-right: 5px;">

			<span class="joy-lang" label="lg:billStateEk"></span>: <input
				id="text_billStateEk" class="joy-combobox joy-enum"
				style="width: 120px;" placeholder="lgc:pleaseToSelect"
				databind="value:billStateEk,source:BILL_STATE_EKEnum">
			</div>
			 <input
				id="txt_search" class="joy-textbox" style="width: 120px;"
				maxByte="20">
			<button class="joy-button" icon="search" onClick="searchQuery"
				label="lgc:search"></button>
			<button class="joy-button" icon="search" onClick="openSearch"
				label="lgc:advSearch"></button>
		</div>
	</div>
	<!-- 搜索栏end -->
	<!-- 列表栏 -->

	<!--产品信息列表 -->
	<table id="grid" class="joy-grid" rowHeightFit="38">
		<thead>
			<tr>
				<th field="noticeCheckId" templateType="checkbox" colWidth="40px"></th>
				<th field="noticeNo" dataType="string" label="lg:noticeNo"
					colWidth="12%"></th>
				<th field="allItemName"  dataType="string"
					label="lg:itemName" colWidth="18%"></th>
				<th field=checkDate  dataFormat="yyyy-MM-dd" dataType="date"  label="lg:checkDate" colWidth="12%" ></th>
				<th field=wmCheckTypeEk enumData="WM_CHECK_TYPE_EKEnum"  align="center" label="lg:wmCheckTypeEk" colWidth="10%" ></th>
				<th field="storageName" dataType="string"
					label="lg:storageName" colWidth="15%"
					></th>
				<th field=createTime align="center" dataFormat="yyyy-MM-dd HH:mm" dataType="date"  label="lg:createTime" colWidth="18%" ></th>
				<th field=billStateEk enumData="BILL_STATE_EKEnum" align="center" label="lg:billStateEk" colWidth="10%" ></th>
				<!-- <th field=resultEk enumData="RESULT_EKEnum" align="center" label="lg:resultEk" colWidth="10%" ></th> -->
				<th colWidth="10%" templateType="template" align="center" label="lg:resultEk">	
						#if(resultEk=='ABNORMAL'){#						
						<span class="blue" onClick="openAbnormalWindow('#:noticeCheckId#')">#:resultEkValue#</span>
						#}else{#
						#:resultEkValue#
						 #}#			
				</th>
				<th colWidth="280px" templateType="template" align="center">										 
					 #if(initResult.INPUTSmc){<!--编辑有权限 -->
				         if(billStateEk=='NO_ISSUE'){#
				          <button class="k-button k-gridBtn k-button-icontext"  onClick="openEditWindow('#:noticeCheckId#')"><span class="k-icon k-i-pencil"></span>#:lgc.edit#</button>						
				         #}else{# <!--有权限但不是未下发，不能点击 -->
				              <button class="k-button k-gridBtn k-button-icontext k-state-disabled" ><span class="k-icon k-i-pencil"></span>#:lgc.edit#</button>						
				         # }	    
					}else{ #<!-- 编辑没有权限 -->
						<button class="k-button k-gridBtn k-button-icontext k-state-disabled"  ><span class="k-icon k-i-pencil"></span>#:lgc.edit#</button>
					# }#	
					
					#if(initResult.PRINTSmc){#<!--打印有权限 -->
					   <button class="k-button k-gridBtn k-button-icontext" onClick="createPrintPage('#:noticeCheckId#')"><span class="k-icon k-i-pencil"></span>#:lg.print#</button>						
			    	#}else{#	<!--打印没有权限-->
					   <button class="k-button k-gridBtn k-button-icontext k-state-disabled" ><span class="k-icon k-i-pencil"></span>#:lg.print#</button>						
			    	#}#		
			    	
			    	#if(initResult.READSmc){#<!--详细有权限 -->
					    <button class="k-button k-gridBtn k-button-icontext" smcBind="READSmc" onClick="openDetailWindow('#:noticeCheckId#')"><span class="k-icon k-i-insert-m"></span>#:lgc.detail#</button>	
			    	#}else{#	<!--详细没有权限-->
				    	<button class="k-button k-gridBtn k-button-icontext k-state-disabled"  ><span class="k-icon k-i-insert-m"></span>#:lgc.detail#</button>	
			    	#}#								
						
				</th>
			</tr>
		</thead>
	</table>
	<!--产品信息列表end -->

	<!--编辑开始 -->
	<div id="editDiv">

		<div class="editBody">
			<form id="dataForm" class="joy-form">
				<div id="editTitle" class="headTitle"></div>
				<!--基础信息 -->

				<input type="hidden" databind="value:noticeCheckId"> 
				<div class="base" id="div_base">
					<div class="baseBor">
						<div class="baseBor_tit">
							<span class="joy-lang" label="lg:basicInfo"></span>
						</div>
					</div>
					<div class="layThree_row">
						<div class="layThree_row_f">
							<input id="systemInfo" class="joy-textbox" style="width: 97%" required="true"
								label="lg:noticeNo" databind="value:noticeNo" disabled="disabled">
						</div>
						<div class="layThree_row_f">                    
						<input
							id="storageId" label="lg:storageName" class="joy-combobox joy-enum" required="true"
							style="width: 97%" placeholder="lgc:pleaseToSelect" dataTextField="storageName" dataValueField="storageId" 
							databind="value:storageId,source:enAbleStorageEnum" change="clearNoitceCheckDetlConfirm">		
								
						</div>
						 <div class="layThree_row_f">						
							<input
								id="wmCheckTypeEk" label="lg:wmCheckTypeEk" class="joy-combobox joy-enum"  required="true"
								style="width: 97%" placeholder="lgc:pleaseToSelect"
								databind="value:wmCheckTypeEk,source:WM_CHECK_TYPE_EKEnum" >			
									
							</div>
					</div>
					<div class="layThree_row">						 					
						<div class="layThree_row_f">
							<input class="joy-datepicker"  style="width: 97%"   id="checkDate" required="true"
							label="lg:checkDate" databind="value:checkDate" >
						</div>
							<div class="layThree_row_f">
						<input class="joy-textbox" style="width: 97%" label="lg:memo" maxByte="1024"
								databind="value:memo">
						</div>			
					</div>										
				</div>
				<!--物料信息 -->
				<div class="base" id="div_detail">
					<div class="baseBor">
						<div class="baseBor_tit">
							<span class="joy-lang" label="lg:itemInfo"></span>
						</div>
					</div>
					
					<div class="detailClass">
						<div class="layThree_button detailClass">
						  <button class="joy-button joy-smc" icon="plus" onClick="itemAdd"
					       label="lgc:add" ></button>
						</div>
					<table align="center" id="noticeCheckDetlGrid" class="joy-grid"  reorderable="false"  
										showPageControl="false"  height="240px"  >
								<thead>
									<tr>							
											<th field="itemCd"  dataType="string" label="lg:itemCd" ></th>
											<th field="itemName" dataType="string" label="lg:itemName" ></th>
											<th field="spec" dataType="string" label="lg:spec"></th>
											<th field="baseUnitName" dataType="string" align="center" label="lg:baseUnitName"></th>
											<th field="inventoryBaseUnitQty" dataType="string" align="center" label="lg:inventoryQty"></th>										
											<th colWidth="190px" templateType="button" align="center">												
												<button icon="close" onClick="deleteRow('#:index#')"
													label="lgc:delete"></button>
												</th>
									</tr>							
								</thead>
						</table>
					</div>
				</div>
				<!--button -->
				<div class="layTwo_row_button" align="right">
					<button class="joy-button" btnType="importantbtn" icon="tick"
						onClick="saveData" label="lgc:save"></button>
					<button class="joy-button  joy-window-close" icon="cancel"
						label="lg:back" onClick="editDivClose"></button>

				</div>
			</form>
		</div>
	</div>
	<!--编辑结束 -->


	<!--详情开始 -->
	<div id="detailDiv">
		<div class="editBody">
			<div id="detailTitle" class="headTitle"><span class="joy-lang" label="lg:detailTitle"></span></div>
			<!--基础信息 -->
			<div class="detailbase" id="div_base">
				<div class="detailbaseBor">
					<div class="baseBor_tit ">
						<span class="joy-lang" label="lg:basicInfo"></span>
					</div>
				</div>
				<div id="" class="detail" center="true" align="left">
					<table id="detailTable" width="93%" align="center"
						class="k-info-table comDetailTable" border="0" cellspacing="0"
						cellpadding="0">
						<tbody>
							<tr height="25">
								<td width="100" class="joy-lang head" label="lg:noticeNo"></td>
								<td width="230" class="joy-label" databind="value:noticeNo"></td>
								<td width="100" class="joy-lang head" label="lg:wmCheckTypeEk"></td>
								<td width="230" class="joy-label joy-enum" databind="value:wmCheckTypeEk,source:WM_CHECK_TYPE_EKEnum"  ></td>
							</tr>
							<tr height="25">
								<td width="100" class="joy-lang head" label="lg:storageName"></td>
								<td width="230" class="joy-label" databind="value:storageName" ></td>
								<td width="100" class="joy-lang head" label="lg:checkDate"></td>
								<td width="230" class="joy-label" dataType="date" dataFormat="yyyy-MM-dd"  databind="value:checkDate"></td>

							</tr>
							<tr height="25">
								<td width="100" class="joy-lang head" label="lg:billStateEk"></td>
								<td width="230" class="joy-label joy-enum" databind="value:billStateEk,source:BILL_STATE_EKEnum"></td>
								<td width="100" class="joy-lang head" label="lg:resultEk"></td>
								<td width="230" class="joy-label joy-enum" databind="value:resultEk,source:RESULT_EKEnum"></td>
							</tr>							
							<tr height="25">								
								<td width="100" class="joy-lang head" label="lg:memo"></td>
								<td width="230" colspan="3" class="joy-label"  style="word-break:break-all;" databind="value:memo"></td>
							</tr>
							
						</tbody>
					</table>
				</div>
			</div>
			<!--基础信息结束 -->
			<!--附加信息开始 -->
			<div class="detailbase" id="div_base">
				<div class="detailbaseBor">
					<div class="baseBor_tit ">
						<span class="joy-lang" label="lg:itemInfo"></span>
					</div>
				</div>
				<div id="" class="detail" center="true" align="left"  style="width:93%;margin:0 auto;">
					<table  align="center"  id="detailNoticeCheckDetlGrid" class="joy-grid"  reorderable="false"  resizable="false"
										showPageControl="false"  height="240px"  >
								<thead>
									<tr>							
											<th field="itemCd"  dataType="string" label="lg:itemCd" ></th>
											<th field="itemName" dataType="string" label="lg:itemName" ></th>
											<th field="spec" dataType="string" label="lg:spec"></th>
											<th field="baseUnitName"   dataType="string" align="center" label="lg:baseUnitName"></th>
									</tr>							
								</thead>
						</table>
					<table width="100%" border="0" align="center" cellpadding="0"
						cellspacing="0">
						<tr>
							<td height="50" align="right" valign="bottom">
								<button class="joy-button joy-window-close" icon="cancel"
									label="lg:back" onclick="detailClose"></button></td>
						</tr>
					</table>
				</div>
			</div>
		<!--附加信息结束 -->
		</div>
	</div>
	<!--详情结束 -->
	<!-- 弹开的新增界面（库存）start -->
	<div id="itemWindow" class="joy-window detail"  center="true"
		align="left" title="lg:selectCategory" style="padding-top:0;"> 
		   <!-- 列表栏 -->
		<table class="main">
			<tr>
				<td class="list_left">
					<div id="rightTitle"><span class="joy-lang" label="lg:categoryId"></span></div>
					<div class="leftTreeBox" > 
			  			<!-- 物料类别树 -->  
						<div id="categoryTree" ></div>
						<!-- 物料类别树 end--> 
	 				 </div>
				</td>
				<td class="list_height">			
					<!--库存列表 --> 
					<div style="height:20px;width:100%;padding-top: 10px;">
						<span class="joy-lang" label="lg:itemName" style="font-weight:bold;"></span>: 
				         <input id="itemNameSearch" class="joy-textbox"  style="width: 160px;" databind="value:itemName"   />
				           <span class="joy-lang" label="lg:itemCd" style="font-weight:bold;"></span>: 
				         <input id="itemCdSearch" class="joy-textbox"  style="width: 160px;" databind="value:itemCd"   />
				        <button class="joy-button" icon="search" onClick="searchItem" label="lgc:search" ></button>
					</div>
	 				<table id="itemGrid" class="joy-grid"   pageSize="10" >
					<thead>
						<tr> 
							<th field="itemId" templateType="checkbox" colWidth="40px"></th>
							<th field="itemCd"   dataType="string"  label="lg:itemCd" colWidth="20%" ></th> 
							<th field="itemName"    dataType="string" label="lg:itemName" colWidth="20%"></th>
		                     <th field="spec"    dataType="string" label="lg:spec" colWidth="20%"></th>
							<th field="baseUnitName"    dataType="string" label="lg:baseUnitName" colWidth="20%" align="center" ></th>
					          <th field="baseUnitQty" dataType="string"  label="lg:inventoryQty" colWidth="15%" align="right"></th>					
						</tr>
					</thead>
					</table> 
					<!--库存列表end --> 
				</td>
			</tr>
		</table>
		<table width="100%" border="0" align="center" cellpadding="0"
			cellspacing="0">
			<tr>
				<td height="40" align="right" valign="bottom">
						<button class="joy-button joy-smc" btnType="importantbtn" icon="tick"
							onClick="addRow" label="lg:add"></button>
						<button class="joy-button  joy-window-close" icon="cancel"
							label="lgc:cancel"></button></td>
			</tr>
		</table>				
	</div>
	<!-- 弹开的新增界面（库存）end -->
	<!-- 修改数量编辑窗口 开始 -->
	    <div id="baseUnitQtyInputWindow" class="joy-window" center="true"
		  title="lg:baseUnitQty"> 
			<table cellspacing=1 cellpadding=3 width="100%" align="center"
				border=0>
				<tbody>					
					<tr>
						<td align="left" > 
							<input class="joy-numerictextbox"	label="lg:baseUnitQty" id="editBaseUnitQty" min="0" max="99999" databind="value:upperLimit">
						</td>  
					</tr>   
				</tbody>
			</table>
			<table width="100%" border="0" align="center" cellpadding="3"
				cellspacing="0">
				<tr>
					<td height="40" align="right" valign="bottom">
						<button class="joy-button" btnType="importantbtn" icon="tick"
							onClick="saveBaseUnitQty" label="lgc:save"></button>
						<button class="joy-button  joy-window-close" icon="cancel"
							label="lgc:cancel"></button></td>
				</tr>
			</table>
	</div>
		<!-- 修改数量编辑窗口结束 -->
	<!-- 高级查询窗口开始 -->
<div id="searchWindow" class="joy-window" title="lgc:search">
	<form  class="joy-form" >
		<table>
		    <tr>
		        <td>
			        <input class="joy-datepicker" label="lg:from" dataFormat="yyyy-MM-dd"  id="txtDate_begin" style="width:160px;"> 
			    </td>
			    <td>
			        <input class="joy-datepicker" label="lg:to"  dataFormat="yyyy-MM-dd"  id="txtDate_end" style="width:160px;" > 
			    </td>
			</tr>	
			    <tr>
		        <td>
			    		<input
							id="moreStorageId" label="lg:storageName" class="joy-combobox joy-enum" 
							 placeholder="lgc:pleaseToSelect" dataTextField="storageName" dataValueField="storageId" 
							databind="value:storageId,source:allStorageEnum" style="width:160px;">	
			    
			    </td>
			    <td>
			        <input
							id="resultEk" label="lg:resultEk" class="joy-combobox joy-enum" 
						  placeholder="lgc:pleaseToSelect" 	databind="value:resultEk,source:RESULT_EKEnum" style="width:160px;">	 
			    </td>
			</tr>			
		</table>	
		<table width="100%" border="0" align="center" cellpadding="3" cellspacing="0">
			<tr>
				<td height="50" align="right" valign="bottom">
					<button class="joy-button" btnType="importantbtn" icon="tick" onClick="moreSelect" label="lgc:search"></button>
					<button class="joy-button  joy-window-close" icon="cancel" label="lgc:cancel"></button>
				</td>
			</tr>
		</table>		 
	</form>
</div>
		<!-- 高级查询窗口结束 -->
	<!-- 异常界面 开始 -->
	 <div id="abnormalWindow" class="joy-window detail" center="true"
		align="left" title="lg:abnormalDetail"> 
		
			<!--基础信息 -->
			<div class="detailbase" id="div_base">
				<div class="abnormalbaseBor">
					<div class="abnormalBor_tit">
						<span class="joy-lang" label="lg:basicInfo"></span>
					</div>
				</div>
				<div id="" class="detail" center="true" align="left">
					<table id="abnormalTable" width="100%" align="center"
						class="k-info-table comDetailTable" border="0" cellspacing="0"
						cellpadding="0">
						<tbody>
							<tr height="25">
								<td width="100" class="joy-lang head" label="lg:noticeNo"></td>
								<td width="230" class="joy-label" databind="value:noticeNo"></td>
								<td width="100" class="joy-lang head" label="lg:wmCheckTypeEk"></td>
								<td width="230" class="joy-label joy-enum" databind="value:wmCheckTypeEk,source:WM_CHECK_TYPE_EKEnum"  ></td>
							</tr>
							<tr height="25">
								<td width="100" class="joy-lang head" label="lg:storageName"></td>
								<td width="230" class="joy-label" databind="value:storageName" ></td>
								<td width="100" class="joy-lang head" label="lg:resultEk"></td>
								<td width="230" class="joy-label joy-enum"  databind="value:resultEk,source:RESULT_EKEnum" ></td>
							</tr>	
							<tr height="25">
								<td width="100" class="joy-lang head" label="lg:abnormalDesc"></td>			 	
								<td colspan="3" >
								  <div class="joy-label"  databind="value:abnormalDesc"  style="height:40px;width:630px;overflow:auto;word-break:break-all;"></div>
								</td>
							</tr> 														
						</tbody>
					</table>
				</div>
			</div>
			<!--基础信息结束 -->
			<!--附加信息开始 -->
			<div class="detailbase" id="div_base">
				<div class="abnormalbaseBor">
					<div class="abnormalBor_tit ">
						<span class="joy-lang" label="lg:itemInfo"></span>
					</div>
				</div>
				<div id="" class="detail" center="true" align="left"  style="width:100%;margin:0 auto;">
					<table  align="center"  id="abnormalGrid" class="joy-grid"   reorderable="false"  
										showPageControl="false"  height="240px"  >
								<thead>
									<tr>							
											<th field="itemCd"  dataType="string" label="lg:itemCd"  colWidth="20%"></th>
											<th field="itemName" dataType="string" label="lg:itemName"  colWidth="24%" ></th>
											<th field="spec" dataType="string" label="lg:spec"  colWidth="13%"></th>
											<th field="baseUnitName" dataType="string" align="center" label="lg:baseUnitName"  colWidth="12%"></th>
											<th field="bookBaseQty" dataType="string" align="right" label="lg:bookBaseQty"  colWidth="12%"></th>
											<th field="checkBaseQty" dataType="string" align="right" label="lg:checkBaseQty"  colWidth="11%"></th>																						
											<th field="result" dataType="string"  label="lg:resultEk"  colWidth="18%"></th>											
																						
									</tr>							
								</thead>
						</table>
					<table width="100%" border="0" align="center" cellpadding="0"
						cellspacing="0">
						<tr>
							<td height="50" align="right" valign="bottom">
						<button class="joy-button" icon="pencil" onclick="openAbnormalDescWindow"
									label="lg:fillAbnormalDesc" ></button>
								<button class="joy-button joy-window-close" icon="cancel"
									label="lgc:close" ></button></td>
						</tr>
					</table>
				</div>
			</div>
		
	</div>
		<!-- 异常界面 结束 -->
	<!-- 异常备注界面开始 -->
		 <div id="abnormalDescWindow" class="joy-window" center="true"
		  title="lg:abnormalDesc"> 
		  		<form id="abnormalDescDataForm" class="joy-form">		 
		  				<input type="hidden" databind="value:noticeOutId"> 
						<table cellspacing=1 cellpadding=3 width="100%" align="center"
							border=0>
							<tbody>					
								<tr>
									<td id="abnormalDescInfo" align="left" > 
			                              <textarea class="joy-textbox" maxByte="1024" style="height:70px;resize:none;" databind="value:abnormalDesc" ></textarea>		
										</td>  
								</tr>   
							</tbody>
						</table>
						<table width="100%" border="0" align="center" cellpadding="3"
							cellspacing="0">
							<tr>
								<td height="40" align="right" valign="bottom">
									<button class="joy-button" btnType="importantbtn" icon="tick"
										onClick="saveAbnormalDesc" label="lgc:save"></button>
									<button class="joy-button  joy-window-close" icon="cancel"
										label="lgc:cancel"></button></td>
							</tr>
						</table>
				</form>
	</div>
		<!-- 异常备注界面结束 -->
		<!-- 打印页面 -->
    <div id="printDiv"  style="display:none;width:100%;">
	   <form>
	      <!-- 头部开始 -->
		  <table  id="printHead" style="width:100%;">
		     <tbody>
		        <tr >
				  <td width="100%"  align="center"  colspan="8" class="joy-lang" label="lg:waterrower">
				           
				   </td>
			    </tr> 
			    <tr >
				  <td width="100%"  align="center" colspan="8" class="joy-lang" label="lg:checkOrder">
				  
				   </td>
			    </tr> 
			    <tr >
				      <td width="15%"  height="12" align="right" class="joy-lang" label="lg:printNoticeNo">
				 		
				 	 </td>
					  <td  width="45%"  colspan="4" class="joy-label" databind="value:noticeNo" >
					  
					  </td>
					   <td  width="11%"  align="right" class="joy-lang" label="lg:printWmCheckTypeEk" >
				 		
				 	   </td>
				 	    <td width="29%" colspan="2"  class="joy-label" databind="value:wmCheckTypeEkValue">
					  
					  </td>
			  </tr> 
			  <tr>
				      <td  align="right" height="12" class="joy-lang" label="lg:printStorageName">
				 		
				 	 </td>
					  <td    colspan="4"   class="joy-label" databind="value:storageName">
					  	
					  </td>
					   <td   align="right"  class="joy-lang" label="lg:printCheckDate">
				 		
				 	   </td>
				 	    <td  colspan="2" class="joy-label" dataType="date" dataFormat="yyyy-MM-dd"  databind="value:checkDate">
					  	
					  </td>
			  </tr> 
			  <tr >
			           <td  align="right"  height="12" class="joy-lang" label="lg:printWmInTypeEk">
				 		 
				 	   </td>
				 	    <td    colspan="2" class="joy-label joy-enum" databind="value:wmInTypeEk,source:WM_IN_TYPE_EKEnum">
					  	
					  </td>
				      <td >
				 		
				 	 </td>
					  <td    colspan="4" >
					 
					  </td>					  
			  </tr>
			  </tbody> 			 
		   </table>
		    <!-- 头部结束 -->
		     <!-- 中间开始 -->
		   	  <table cellspacing="0" width="91%" cellpadding="0" style="margin-top:10px;border-collapse:collapse;" >
		   	    <colgroup>
                                       <col style="width:15%;">
									    <col style="width:20%;">
									    <col style="width:15%;">
									    <col style="width:10%;">        
									   <col style="width:10%;">
									   <col style="width:10%;">
									   	<col style="width:20%;">									   
									</colgroup>
		   	  <tbody id="itemList" style="text-align:center;">
		   	    <!-- <tr  id="printHeadTitle">
					  	<th class="first" >序号</th>
						<th>物料编码</th>
						 <th>物料名称</th>
						<th>型号规格</th>
						<th>商品序列号</th>  
						<th>数量</th>
						<th>单位</th>
						<th>备注</th>
				</tr>	
				    		   
			    <tr >
				      <td class="first">
				 		10000
				 	 </td>
					  <td>
				 		1010001
				 	 </td>
				 	  <td >
				 		划船器
				 	 </td>
				 	  <td>
				 		A1 Home
				 	 </td>
				 	  <td>
				 		1010001
				 	 </td>
				 	  <td  >
				 		10000
				 	 </td>
				 	  <td>
				 		台
				 	 </td>
				 	  <td>
				 		无
				 	 </td>
			     </tr> 	-->	  			   
			   </tbody> 
		   </table>
		    <!-- 中间结束 -->
		    <!-- 尾部开始 -->
		     <table  style="margin-top:20px;" width="100%">
			     <tbody>
				        <tr >
						  <td width="10%"  align="center" height="12"  class="joy-lang" label="lg:finance">
						    
						   </td>
						     <td  width="23%"    ></td>
						    <td width="10%"  align="center"    class="joy-lang" label="lg:audit" >
						        
						   </td>
						     <td  width="23%"    ></td>
						    <td width="10%"  align="center" class="joy-lang" label="lg:storageor" >
						  
						   </td>
						     <td  width="24%"    ></td>
					    </tr> 					   
				    </tbody>
			 </table>
			  <!-- 尾部结束 -->
</form>
    </div>
    <!-- 打印页面结束 -->
    <!-- 验证是否安装控件页面 -->
    <div id="checkIsInstallLodopDiv" style="display:none;">
    
    </div>
<script id="category_tree" type="text/joy-ui-template">
			<span class="itemName" onclick="categoryTreeviewclick('#=item.main.categoryId#','#=item.main.isLastFlag#')" >#=item.main.name#</span>   
	 </script>

	<script type="text/javascript">
		var initResult,lgc,lg,dataForm,grid,itemWindow,curStorageId,noticeCheckDetlGrid,itemGrid,noticeCheckDetlDataSource,curStorageId,systemInfoTextBox;
		var baseUnitQtyInputWindow,itemIds,searchWindow,txtDate_begin,txtDate_end,detailNoticeCheckDetlGrid,abnormalWindow,abnormalGrid;
		var billStateEkComboBox,noticeNoTextBox,storageIdComboBox,resultEkComboBox;
		var abnormalDescWindow,abnormalDescDataForm;
		var searchUrl = "../../wl/wm/wlWmNoticeCheckAction.do?action=findDataList";
		var itemSearchUrl = "../../wl/wm/wlWmNoticeCheckAction.do?action=findItemDataList";
		$().ready(function() {
			lgc = joy.getCommonLang();
			lg = joy.getLang();
			searchContent =lg.searchContent;
			$("#txt_search").attr("placeholder",searchContent);
			systemInfoTextBox=$("#systemInfo").getJoyTextBox();
			itemWindow = $("#itemWindow").getJoyWindow();
			abnormalWindow = $("#abnormalWindow").getJoyWindow();			
			baseUnitQtyInputWindow = $("#baseUnitQtyInputWindow").getJoyWindow();
			dataForm = $("#dataForm").getJoyForm();			
			grid = $("#grid").getJoyGrid();
			itemGrid=$("#itemGrid").getJoyGrid();
			abnormalGrid=$("#abnormalGrid").getJoyGrid();
			noticeCheckDetlGrid=$("#noticeCheckDetlGrid").getJoyGrid();
			detailNoticeCheckDetlGrid=$("#detailNoticeCheckDetlGrid").getJoyGrid();
			searchWindow = $("#searchWindow").getJoyWindow();	
			var date=new Date();
			txtDate_begin=$("#txtDate_begin").getJoyDatePicker();
			txtDate_end=$("#txtDate_end").getJoyDatePicker();
			txtDate_begin.value(date.Format("yyyy-MM-dd"));
			txtDate_end.value(date.Format("yyyy-MM-dd"));
			 billStateEkComboBox=$("#text_billStateEk").getJoyComboBox();
				 noticeNoTextBox = $("#txt_search").getJoyTextBox();
				 storageIdComboBox = $("#moreStorageId").getJoyComboBox();
				resultEkComboBox = $("#resultEk").getJoyComboBox();
				abnormalDescDataForm=$("#abnormalDescDataForm").getJoyForm();
				abnormalDescWindow=$("#abnormalDescWindow").getJoyWindow();
			//数据初始化
			joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=init", {
				enumTypes : [ 'WM_CHECK_TYPE_EK','RESULT_EK','BILL_STATE_EK']
			}, function(resultObject) {
				initResult = resultObject;
				//将后台action得到的枚举ENUM,和前台的databind的枚举,如果值相同进行绑定
				var viewModel = joy.observable(initResult);
				joy.bind($(".joy-smc,.joy-enum"), viewModel); //class为smc enum时进行绑定
				  treeviewBind();
				  clearNoitceCheckDetl();//清除从表数据
			       grid.fetch(initResult, searchUrl);  
			});						
		});
		
		//打开新增窗口
		function openAdd() {
			curStorageId="";//当前仓库id
				dataForm.load();
				 clearNoitceCheckDetl();//清除从表数据;
				var height = $(window).height();
				$("#editDiv").css({
					"min-height" : height + "px",
					"height" : "auto"
				});
				$("#editTitle").text(lg.addTitle);
				systemInfoTextBox.value(lg.systemInfo);
				$("#editDiv").show();
				 		
		}
		  //打开编辑编辑
		 function openEditWindow(noticeCheckId){
			// noticeCheckDetlDataSource
			 //itemIds
			 joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=getData", {
				 noticeCheckId : noticeCheckId
				}, function(resultObject) {							
							   noticeCheckDetlDataSource=resultObject.noticeCheckDetl; 				    
								for(var i = 0;i<noticeCheckDetlDataSource.length;i++){
									noticeCheckDetlDataSource[i].index = i;
									itemIds[i]=noticeCheckDetlDataSource[i].itemId;//用于排除从表的数据在新增界面不再显示
								} 		
								curStorageId=resultObject.noticeCheck.storageId;
								dataForm.load(resultObject.noticeCheck);//加载主表				
								noticeCheckDetlGrid.load(initResult,noticeCheckDetlDataSource);//加载从表
								storageIsEnableFlag=resultObject.storageIsEnableFlag;//仓库是否锁定
								if(storageIsEnableFlag==='0'){//仓库停用
								    joy.showMessage(lg.storageLock, "warning");
									$("#storageId").getJoyComboBox().value("");
								}
								var height = $(window).height();
								$("#editDiv").css({
									"min-height" : height + "px",
									"height" : "auto"
								});
								$("#editTitle").text(lg.editTitle);
								$("#editDiv").show();
							    
						});										  
		 }
		  //确认是否更换仓库
		  function clearNoitceCheckDetlConfirm(){
			  if(noticeCheckDetlDataSource.length>0){//如果从表有数据
					joy.showMessageDialog(lg.clearNoticeCheckDetlByStorage, "ok,cancel", function(e) {
						if (e.btnName == "ok") {
							clearNoitceCheckDetl();	
							curStorageId=$("#storageId").getJoyComboBox().value();
						}else{							
							$("#storageId").getJoyComboBox().value(curStorageId);
						}
					});		  
			  }else{
				  clearNoitceCheckDetl();
			  }
			  
		  }
		  //清除新增或编辑的从表数据
		  function clearNoitceCheckDetl(){
			  noticeCheckDetlDataSource=new Array();
			  itemIds=new Array();
			  noticeCheckDetlGrid.load(initResult,noticeCheckDetlDataSource);
		 }
		//关闭编辑窗口
		function editDivClose(){
			$("#editDiv").hide();
		}
		//打开详细窗
		function openDetailWindow(noticeCheckId){
			
			 joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=getData", {
				 noticeCheckId: noticeCheckId
				}, function(resultObject){
					var viewModel = joy.observable(resultObject.noticeCheck); 
					joy.bind($("#detailTable"), viewModel);
					detailNoticeCheckDetlGrid.load(initResult,resultObject.noticeCheckDetl);//加载从表
						var height = $(window).height();
						$("#detailDiv").css({
							"min-height" : height + "px",
							"height" : "auto"
						});									
						$("#detailDiv").show();
	          	});			
		
		}
		//关闭详细窗口
		function detailClose(){
			$("#detailDiv").hide();
		}
		
		/**
		 * 打开物料添加
		 */
		function itemAdd(){
			curStorageId = $("#storageId").getJoyComboBox().value();
           if(curStorageId===""){
				joy.showMessage(lg.pleaseSelectStorage, "warning");
           }else{
        	   categoryTreeviewclick("0","0");
				itemWindow.open();	
				itemWindow.center();	
           }
		}		
		//treeview数据初始化   传入状态
		function treeviewBind(){
			joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=getTree",{
				isEnableFlag : "1",
				isLastFlag:"",
				rootId:"0"	
			}, function(resultObject) { 
				//alert(joy.ifstringy(resultObject));
					categoryTreeView =  $("#categoryTree").joyTreeView({
			             dataSource:resultObject.items,
			             templateID:"category_tree" 
			        }); 			  
			});
		}
		

		//菜单点击事件(新增按钮旁边的树点击事件)
		var curCategoryId="";
		function categoryTreeviewclick(categoryId,isLastFlag){
			var obj=new Object();	
			 if(isLastFlag=='0'){
				 categoryId="-1";//当不是末级节点的时候，清空grid数据
			}					
				obj.categoryId=categoryId;	
				 curCategoryId=categoryId;
			   obj.storageId=curStorageId;
			   obj.itemIds=itemIds;
			   itemGrid.fetch(initResult, itemSearchUrl, obj);			
		}
		//添加保存物料信息
	  function addRow(buttonObject){

		  var ids = itemGrid.getChecked();
			if (ids.length == 0) {
				joy.showMessage(lgc.chooseRecord, "warning");
			} else{
				joy.getJSON(
						"../../wl/wm/wlWmNoticeCheckAction.do?action=findItemList",
						{
							itemIds : ids,storageId:curStorageId
						}, function(resultObject) {
							
							for(i=0;i<resultObject.length;i++){							
								 obj=resultObject[i];
								 index=noticeCheckDetlDataSource.length;
								 obj.index=index;
								 noticeCheckDetlDataSource[index]=obj;
									itemIds[index]=obj.itemId;
								 noticeCheckDetlGrid.load(initResult,noticeCheckDetlDataSource); 
								// itemWindow.close();	
							}
							  var obj=new Object();	
							   obj.categoryId=curCategoryId;	
							   obj.storageId=curStorageId;
							   obj.itemIds=itemIds;
							   itemGrid.fetch(initResult, itemSearchUrl, obj);	
						});
			} 
	  }
	  function deleteRow(index){ 
		  joy.showMessageDialog(lgc.deleteConfirm, "ok,cancel", function(e) {	  
				if (e.btnName == "ok") {
					for(var i=0;i<noticeCheckDetlDataSource.length-1;i++){ 				
					if(i>=index){
						var obj = noticeCheckDetlDataSource[i+1];
						var itemObj=itemIds[i+1];
						obj.index = i;					
						noticeCheckDetlDataSource[i]=obj;
						itemIds[i]=itemObj;
					}
			     }
				 noticeCheckDetlDataSource.pop(); 
				 itemIds.pop(); 
				 noticeCheckDetlGrid.load(initResult,noticeCheckDetlDataSource); 
		 }});
	}
	
	  //保存数据
	  function saveData(buttonObject){
		  buttonObject.enable(false);
		  if (!dataForm.validate()) {
				joy.showMessage(lgc.validateFaile, "warning");
				buttonObject.enable(true);
				return;
			}		  		
		    if(noticeCheckDetlDataSource.length===0){
		    	 joy.showMessage(lg.pleaseAddItem, "warning");
		    	 buttonObject.enable(true);
		    	 return;
		    }
		     var submitda = dataForm.getDataModel().toJSON();
			submitda.wlWmNoticeCheckDetls=joy.stringify(noticeCheckDetlDataSource);
			dataForm.load(submitda);
			dataForm.submit("../../wl/wm/wlWmNoticeCheckAction.do?action=saveData", buttonObject,
					function(resultObject) { 		
				         editDivClose();
				         buttonObject.enable(true);
						joy.showMessage(lgc.opSuccess, "success");
						grid.dataSource.fetch();
					});		  
	  }
	
	  //查询
	  function searchQuery(){
		  //搜索条件obj构成为
			var obj=new Object();
			var billStateEk=billStateEkComboBox.value();
			var noticeNo = noticeNoTextBox.value();
			obj.billStateEk=billStateEk;
			obj.noticeNo=noticeNo;
			var paraMap=joy.getParaMap(obj);
	        grid.fetch(initResult,searchUrl,paraMap);  
	  }
	//打开高级搜索
	  function openSearch()
	  {
	  	$("#searchWindow").parent('.k-widget').css({'top':'40px','right':"20px"});
	  	$("#searchWindow").parent('.k-widget').css('left',"");
	  	//$("#searchWindow").getJoyWindow().setOptions({position:{top:40,left:200}});
	  	searchWindow.open();
	  }
	//高级搜索执行搜索

	  function moreSelect(){
		  //搜索条件obj构成为
			var obj=new Object();
		  beginDate=txtDate_begin.value();
		  endDate=txtDate_end.value();
		     var billStateEk=billStateEkComboBox.value();
			 var noticeNo = noticeNoTextBox.value();
			 var storageId = storageIdComboBox.value();
				var resultEk = resultEkComboBox.value();		
				obj.beginDate=beginDate;
				obj.endDate=endDate;
				obj.billStateEk=billStateEk;
				obj.noticeNo=noticeNo;
				obj.storageId=storageId;
				obj.resultEk=resultEk;
				var paraMap=joy.getParaMap(obj);
		        grid.fetch(initResult,searchUrl,paraMap);  
	  }
	//下发
	function issue(){
		var ids = grid.getChecked();
		if (ids.length == 0) {
			joy.showMessage(lgc.chooseRecord, "warning");
		} else{
			
			joy.showMessageDialog(lg.issueConfirm, "ok,cancel", function(e) {
				if (e.btnName == "ok") {
					joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=updateBillStateToIssue",{noticeCheckIds:ids},function(resultObject){
						if(resultObject!=""){
							joy.showMessage(resultObject, "warning");
						}else{			
						joy.showMessage(lgc.opSuccess, "success");
					      grid.fetch(initResult, searchUrl);
						}
					});		
					
				}
			});
		}		
	}
	//作废
	function cancel(){
		var ids = grid.getChecked();
		if (ids.length == 0) {
			joy.showMessage(lgc.chooseRecord, "warning");
		} else{			
			joy.showMessageDialog(lg.cancelConfirm, "ok,cancel", function(e) {
				if (e.btnName == "ok") {
					joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=updateBillStateToCancle",{noticeCheckIds:ids},function(resultObject){
							if(resultObject!=""){
								joy.showMessage(resultObject, "warning");
							}else{			
							joy.showMessage(lgc.opSuccess, "success");
						      grid.fetch(initResult, searchUrl);
							}
					});	
				}
			});
		}		
	}
	/**
	 * 删除数据
	 */
	function deleteData() {
		var ids = grid.getChecked();

		if (ids.length == 0) {
			joy.showMessage(lgc.chooseRecord, "warning");
		} else {
			joy.showMessageDialog(lgc.deleteConfirm, "ok,cancel", function(e) {
				if (e.btnName == "ok") {
					joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=deleteData",{noticeCheckIds: ids}, function(resultObject) {															
								if(resultObject!=""){
									joy.showMessage(resultObject, "warning");
								}else{			
									grid.dataSource.fetch();
									joy.showMessage(lgc.opSuccess, "success");
								}
							});
				}
			});
		}
	}
	//打开异常窗口
	function openAbnormalWindow(noticeCheckId){
		 joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=getAbnormalData", {
			 noticeCheckId: noticeCheckId
			}, function(resultObject){
				var viewModel = joy.observable(resultObject.noticeCheck); 
				abnormalDescDataForm.load(viewModel);//将数据加载到异常备注界面
				joy.bind($("#abnormalTable"), viewModel);
				abnormalGrid.load(initResult,resultObject.abnormal);//加载从表																								
					abnormalWindow.open();	
					abnormalWindow.center();	
          	});			
	}
	//打开异常备注界面
	function openAbnormalDescWindow(){
		$("#abnormalDescInfo .k-form-label").remove();//将输入框的标题代码去掉
		abnormalDescWindow.open();
		abnormalDescWindow.center();	
	}
	//保存异常备注
	function saveAbnormalDesc(buttonObject){
		buttonObject.enable(false);
		if (!abnormalDescDataForm.validate()){
			joy.showMessage(lgc.validateFaile,"warning");
			buttonObject.enable(true);
			return;
		}			
		  var submitda =  abnormalDescDataForm.getDataModel().toJSON();
			joy.bind($("#abnormalTable"), submitda);//修改异常明细界面的异常备注
		  abnormalDescDataForm.submit("../../wl/wm/wlWmNoticeCheckAction.do?action=saveData", buttonObject,function(resultObject){
			  abnormalDescWindow.close();	
			  joy.showMessage(lgc.opSuccess,"success");
		});			
	}
	/**
	 * 生成打印页面
	 **/
	 function createPrintPage(noticeCheckId){
		
		  	 var txt='<tr  id="">';
				   	txt+='<td height="35px" style="border:1px solid #000;">'+lg.itemCd+'</td>';
				   	txt+='<td style="border:1px solid #000;">'+lg.itemName+'</td>';
				   	txt+='<td style="border:1px solid #000;">'+lg.spec+'</td>';
				   	txt+='<td style="border:1px solid #000;">'+lg.baseUnitName+'</td>';
				   	txt+='<td style="border:1px solid #000;">'+lg.bookBaseQty+'</td>'; 
				   	txt+='<td style="border:1px solid #000;">'+lg.checkBaseQty+'</td>';
				   	txt+='<td style="border:1px solid #000;">'+lg.memo+'</td>';
				   	txt+='</tr>';
		 joy.getJSON("../../wl/wm/wlWmNoticeCheckAction.do?action=getPrintData",{noticeCheckId:noticeCheckId}, function(resultObject){	
			 $("#itemList").empty();
			 joy.bind($("#printHead"), resultObject.wlWmNoticeCheck);
			  obj=resultObject.wlWmNoticeCheckDetlList;
			 for(var i=0;i<obj.length;i++){
				   ob=obj[i];
				     txt+='<tr height="35px"  >';
				     txt+='<td class="first" style="border:1px solid #000;">';
				    txt+=ob.itemCd;
					 txt+='</td>';
					txt+='<td  style="border:1px solid #000;">';
					txt+=ob.itemName;
					txt+='</td>';
					 txt+='<td  style="border:1px solid #000;">';
					 txt+=ob.spec;
					 txt+='</td>';
					txt+='<td  style="border:1px solid #000;">';
					txt+=ob.baseUnitName;
					txt+='</td>';
					txt+='<td  style="border:1px solid #000;">';
					if(ob.baseUnitQty!==null){
					txt+=ob.baseUnitQty;
					}
					txt+='</td>';
					txt+='<td  style="border:1px solid #000;">';
					txt+='</td>';
					txt+='<td  style="border:1px solid #000;">';
					txt+='</td>';
				 	txt+='</tr>';					   
			 }
			 $("#itemList").append(txt);
				startPrint();
			});				 
	 }	 
	 /**
	 *	开始打印
	 **/
	 function startPrint(){
		    var LODOP=getLodop();
			var strHTML=document.getElementById("printDiv").innerHTML;
			LODOP.ADD_PRINT_HTM("2%","5%","100%","BottomMargin:20mm",strHTML);
			LODOP.NewPageA();
			LODOP.PREVIEW();
	 }
	 /**
		 * 搜索物料
		 */
		function searchItem()
		{			  
			var obj=new Object();
			var itemName=$("#itemNameSearch").getJoyTextBox().value();
			var itemCd = $("#itemCdSearch").getJoyTextBox().value();	
			obj.itemName=itemName;
			obj.storageId=curStorageId;
			obj.itemCd=itemCd;
			obj.categoryId=curCategoryId;
			itemGrid.fetch(initResult, itemSearchUrl, obj);	
		}
	</script>

</body>
</html>