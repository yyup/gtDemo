<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="Generator" content="waterrower Team">
    <meta name="Author" content="waterrowerTeam">
    <meta name="Keywords" content="沃特罗伦WaterRower（直译水划船机）始创于1988年。由美国国家划船队John Duke与耶鲁大学联合设计，并获发明专利。不仅是品牌，更是划船器水阻化的标志性里程碑。">
    <meta name="Description" content="沃特罗伦WaterRower（直译水划船机）始创于1988年。由美国国家划船队John Duke与耶鲁大学联合设计，并获发明专利。不仅是品牌，更是划船器水阻化的标志性里程碑。">
    <script src="../../js/newsite/jquery.min.js"></script>
    <script src="../../js/newsite/bootstrap.js"></script>
    <script src="../../js/newsite/getSystemPlatform.js"></script>
    <script src="../../js/engsite/wlcommon.js"></script>
    <script src="../../js/joy.loader.js" modules="form,dataview,advgrid,layout"></script>
    <script src="../../js/newsite/cnzz.js"></script>
	<link rel="stylesheet" href="../../style/prj/engsite/header.css"/>
	<link rel="stylesheet" href="../../style/prj/engsite/footer.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/bootstrap-datetimepicker.min.css"/>
	<link rel="stylesheet" href="../../style/prj/engsite/wlcommon.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/personInfo.css"/>
    <link href="../../style/prj/engsite/bootstrapValidator.min.css" rel="stylesheet">
	<script src="../../js/newsite/bootstrapValidator.min.js"></script>
    <script src="../../js/newsite/bootstrap-datetimepicker.min.js"></script>
    <script src="../../js/newsite/bootstrap-datetimepicker.zh-CN.js"></script>
</head>

<body>
 	<div id="top">
 		<div id="commonpath" style="display: none;" commonpath=""></div>
 	</div>
  <!-- 内容 -->
  <div id="wlBody"  class="contentMargin" >
      <div class="container" style="margin-top: 100px;">
      
          <div class="row rightLeft" id="rightLeft" >
              
              <div class="col-md-9" style="margin-top: 70px;">
	              <form id="personInfoForm"  method="post" class="joy-form form-horizontal " layout="freedom">
	                  <div class="row" >
	                      <div class="col-md-4">
	                        <span  class="pull-right inputTitle">Account</span>
	                      </div>
	                      <div class="col-md-6">
	                          <input type="text" class="inputText form-control" value="123123" disabled="disabled" databind="value:account">
	                      </div>
	                  </div>
	                  <div class="row inputMargin ">
	                      <div class="col-md-4">
	                          <span class="pull-right inputTitle">Gender</span>
	                      </div>
	                      <div class="col-md-6">  
		                         <div class='input-group inputText' >  
					             <input id="sexType" type="text" name="inputSexEk" style="background:white;" class="inputText form-control" readOnly="true"  databind="value:sexEk">
					                <span style="display:table-cell;vertical-align: middle;width:1%">  
					                    <span class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="caret"></span></span>
                                          <ul id="select" class="dropdown-menu dropdown-menu-right">
                                          </ul>
					                </span>  
					            </div>  
	                      </div>
	                  </div>
	                  <div class="row inputMargin " >
	                      <div class="col-md-4">
	                          <span class="pull-right inputTitle">Birthday</span>
	                      </div>
	                      <div class="col-md-6">
					            <!--指定 date标记-->  
					            <div class='input-group date inputText'  id='datetimepicker'  data-date-format="yyyy-mm-dd">  
					                <input type='text' class="form-control" id="inputBirthday" dateformat readOnly="true"  style="background:white;" databind="value:birthday" onChange="textChange(this,'inputBirthday')"/>  
					                <span class="input-group-addon">  
					                    <span class="glyphicon glyphicon-calendar"></span>  
					                </span>  
					            </div>  
	                      </div>
	                  </div>
	                  <div class="row inputMargin form-group" >
	                      <div class="col-md-4">
	                          <span  class="pull-right inputTitle">Phone</span>
	                      </div>
	                      <div class="col-md-6">
	                          <input id="inputPhone" name="inputPhone" type="text" class="inputText form-control"  databind="value:mobile" onkeyup="textChange(this,'inputPhone')" />
	                      </div>
	                  </div>
	                  <div class="row  form-group" >
	                      <div class="col-md-4">
	                          <span  class="pull-right inputTitle">Email</span>
	                      </div>
	                      <div class="col-md-6  ">
	                          <input id="inputEmail" name="inputEmail"  type="email" class="inputText form-control"  databind="value:email" onkeyup="textChange(this,'inputEmail')" />
	                      </div>
	                  </div>
	                  <div class="inputMargin">
	                      <div class="col-md-4">
	                      </div>
	                      <div class="col-md-6">
	                          <div class="editPassword" onclick="editPassword()">Change Password</div>
	                      </div>
	                  </div>
	                  <div class="row" style="margin-top: 60px;">
	                      <div class="col-md-12" style="text-align: center">
	                          <input type="button" value="Save" onclick="savePersonInfo()" class="saveButton">
	                      </div>
	                  </div>
				 </form>
              </div>
          </div>
          <div class="topBottom" id="topBottom">

              <form id="smallPersonInfoForm"  method="post" class="joy-form form-horizontal " layout="freedom">
                  <div class="row form-group" >
                      <div class="col-xs-3">
                          <span style="font-size: 14px;" class="pull-right">Account</span>
                      </div>
                      <div class="col-xs-8">
                          <input type="text" class="inputText form-control" value="" disabled="disabled" databind="value:account">
                      </div>
                  </div>
                  <div class="row inputMargin form-group" >
                      <div class="col-xs-3">
                          <span style="font-size: 14px;" class="pull-right">Gender</span>
                      </div>
                      <div class="col-xs-8">
               
		                        <div class='input-group inputText' >  
					             <input id="smallsexType" type="text" name="inputSexEk" style="background:white;" class="inputText form-control" readOnly="true"  databind="value:sexEk">
					                <span style="display:table-cell;vertical-align: middle;width:1%">  
					                    <span class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="caret"></span></span>
                                          <ul id="smallselect" class="dropdown-menu dropdown-menu-right">
                                          </ul>
					                </span>  
					            </div>  
                      </div>
                  </div>
                  <div class="row inputMargin form-group" >
                      <div class="col-xs-3">
                          <span style="font-size: 14px;" class="pull-right">Birthday</span>
                      </div>
                      <div class="col-xs-8">
	                     <!--指定 date标记-->  
					            <div class='input-group date inputText'  id='smalldatetimepicker'  data-date-format="yyyy-mm-dd">  
					                <input type='text' class="form-control" id="smallinputBirthday"  readOnly="true"  style="background:white;" databind="value:birthday" onChange="textChange(this,'smallinputBirthday')"/>  
					                <span class="input-group-addon">  
					                    <span class="glyphicon glyphicon-calendar"></span>  
					                </span>  
					            </div>  
                      </div>
                  </div>
                  <div class="row inputMargin form-group">
                      <div class="col-xs-3">
                          <span style="font-size: 14px;" class="pull-right">Phone</span>
                      </div>
                      <div class="col-xs-8">
                          <input id="smallinputPhone" name="smallinputPhone" type="text" databind="value:mobile"  class="inputText form-control" onkeyup="textChange(this,'smallinputPhone')"  />
                      </div>
                  </div>
                  <div class="row inputMargin form-group">
                      <div class="col-xs-3">
                          <span style="font-size: 14px;" class="pull-right">Email</span>
                      </div>
                      <div class="col-xs-8">
                          <input id="smallinputEmail" name="smallinputEmail" databind="value:email" type="email" class="inputText form-control" onkeyup="textChange(this,'smallinputEmail')"   />
                      </div>
                  </div>
                  <div class="inputMargin">
                      <div class="col-xs-3">
                      </div>
                      <div class="col-xs-8">
                          <div class="smallEditPassword" onclick="editPassword()" >Change Password</div>
                      </div>
                  </div>
                  <div class="row" style="margin-top: 60px;">
                      <div class="col-md-12" style="text-align: center">
                          <input type="button" value="Save" onClick="savePersonInfo()" class="saveButton">
                      </div>
                  </div>
             </form>
          </div>
      </div>
  </div>
          <!--第一个商品结束-->
  <!-- 内容结束 -->
<!--尾部开始-->
    <div id="footerPart">
      
    </div>
<!--尾部结束-->

	<script>
	 

	var memberId,password;
	var personInfoForm,lgc,sexEnum;
	var smallPersonInfoForm;
	 $().ready(function() {
		 initTop();
		 initClick();
		 initBottom();
		 initAccountInfo();
		  validata();
		  init();
		 $('#datetimepicker').datetimepicker({  
			  language: 'zh-EN',
			   weekStart: 1,
		        todayBtn:  1,
				autoclose: 1,
				todayHighlight: 1,
				startView: 2,
				minView: 2,
				forceParse: 0,
		    });  
		 $('#smalldatetimepicker').datetimepicker({  
			  language: 'zh-EN',
			   weekStart: 1,
		        todayBtn:  1,
				autoclose: 1,
				todayHighlight: 1,
				startView: 2,
				minView: 2,
				forceParse: 0,
		    }); 
		 
 
  	 });
		function validata() {
	        $('#personInfoForm').bootstrapValidator({
	            feedbackIcons: {
	            	valid: 'glyphicon glyphicon-ok',
	                invalid: 'glyphicon glyphicon-remove',
	                validating: 'glyphicon glyphicon-refresh'
	            },
	            fields: {
	            	inputPhone: {
	                    validators: {	                     
	                        stringLength: {//检测长度  
	                            min: 11,  
	                            max: 11,  
	                            message: 'The phone number in the mainland of China should be 11 digits'  
	                        },
	                        regexp: {//正则验证  
	                            regexp: /^[Z0-9_\.]+$/,  
	                            message: 'Please enter correct phone number'  
	                        }
	                    }
	                },
	                inputEmail: {
	                    validators: {
	                        
	                        emailAddress: {//验证email地址  
	                            message: 'Please enter a valid email address (Ex: johndoe@domain.com)'  
	                        }
	                    }
	                },
	                
	            }
	        });
	    }

		function init(){
			lgc = joy.getCommonLang();
			personInfoForm = $("#personInfoForm").getJoyForm();
			smallPersonInfoForm = $("#smallPersonInfoForm").getJoyForm();
			joy.getJSON("../../wl/cm/wlCmMemberAction.web?action=init",
					{enumTypes:['SEX_EK_EN']},	
					function(resultObject) {
						sexEnum=resultObject.SEX_EK_ENEnum;
						for(var i=0;i<sexEnum.length;i++){
							txt='<li><a id="sex'+i+'" onclick="sexOnclick('+i+')" trueValue='+sexEnum[i].value+'>'+sexEnum[i].text+'</a></li>';
							$("#select").append(txt);
							$("#smallselect").append(txt);
						}
						getData();

				});		
		}
		//下拉框点击事件
		function sexOnclick(i){
			var sexText=$("#sex"+i).text();
			$("#sexType").val(sexText);
			$("#sexType").attr("trueValue",$("#sex"+i).attr("trueValue"));
			$("#smallsexType").val(sexText);
			$("#smallsexType").attr("trueValue",$("#sex"+i).attr("trueValue"));
		}
		
		//获取数据
		function getData(){
			joy.getJSON("../../wl/cm/wlCmMemberAction.web?action=getTableData",{}, function(resultObject){	
    			memberId = resultObject.memberId;
    			password = resultObject.password;
    			if(resultObject.birthday!=null){
    				resultObject.birthday=resultObject.birthday.substr(0,10);
    			}
    			//var viewModel = joy.observable(resultObject); 
    			//joy.bind($("#baseInfoForm"), viewModel);
    			personInfoForm.load(resultObject);
    			smallPersonInfoForm.load(resultObject);
    			for(var i=0;i<sexEnum.length;i++){
    				if(resultObject.sexEk==sexEnum[i].value){
	    				$("#sexType").val(sexEnum[i].text);
	    				$("#sexType").attr("trueValue",sexEnum[i].value);
	    				$("#smallsexType").val(sexEnum[i].text);
	    				$("#smallsexType").attr("trueValue",sexEnum[i].value);
    				}
				}
    			
    		});	
		}
		
		 //文字改变
		 function textChange(obj,id){		
			 	var state=id.indexOf("small");
			 	if(state==-1){
			 		$("#small"+id).val(obj.value);
			 		
			 	}else{
			 		id=id.substr(5,id.length-1);
			 		$("#"+id).val(obj.value);		
			 	}
		 }

		
		//保存
		var lgfg = true;
		function savePersonInfo(buttonObject){	
			if (!lgfg) {
				lgfg=true;
				return;
			}
			var sexEk=$("#sexType").attr("trueValue");
			var birthday=($("#inputBirthday").val());
			var mobile=($("#inputPhone").val());
			var email=($("#inputEmail").val());
			var bootstrapValidator = $('#personInfoForm').data('bootstrapValidator');
	        bootstrapValidator.validate();
	        if (bootstrapValidator.isValid()) {//如果校验成功后执行的操作
	        	 lgfg = false;
				var submitda = personInfoForm.getDataModel().toJSON();
				submitda.password = password;
				submitda.sexEk=sexEk;
				submitda.birthday=birthday;
				submitda.mobile=mobile;
				submitda.email=email;
				personInfoForm.load(submitda);
				//name=submitda.name;
				personInfoForm.submit("../../wl/cm/wlCmMemberAction.web?action=saveData",
					buttonObject, function(resultObject) {
				    joy.showMessage("Success", "success");
					getData();
					lgfg = true;
					return;
				});
	        }
		}
		
		function editPassword(){
	    	 window.location = "editPassword.html";
	    }
		
	</script>
</body>
</html>