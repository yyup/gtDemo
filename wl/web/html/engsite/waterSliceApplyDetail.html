<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="Generator" content="waterrower Team">
    <meta name="Author" content="waterrowerTeam">
    <meta name="Keywords" content="沃特罗伦WaterRower（直译水划船机）始创于1988年。由美国国家划船队John Duke与耶鲁大学联合设计，并获发明专利。不仅是品牌，更是划船器水阻化的标志性里程碑。">
    <meta name="Description" content="沃特罗伦WaterRower（直译水划船机）始创于1988年。由美国国家划船队John Duke与耶鲁大学联合设计，并获发明专利。不仅是品牌，更是划船器水阻化的标志性里程碑。">
    <script src="../../js/newsite/jquery.min.js"></script>
    <script src="../../js/newsite/bootstrap.js"></script>
    <script src="../../js/newsite/getSystemPlatform.js"></script>
    <script src="../../js/engsite/wlcommon.js"></script>
    <script src="../../js/newsite/cnzz.js"></script>
    <link rel="stylesheet" href="../../style/prj/engsite/header.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/footer.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/wlcommon.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/waterSliceApplyDetail.css"/>
    <link rel="stylesheet" href="../../style/prj/engsite/pagination.css"/>
     <!-- 分页 -->
    <script src="../../js/engsite/jquery.pagination.js"></script>
    
    <script src="../../js/joy.loader.js" modules="dataview"></script>
 
</head>

<body>
<!-- 头部 -->
	<div id="top">
		<div id="commonpath" style="display: none;" commonpath=""></div>
	</div>
<!-- 内容 -->
<div id="wlBody"  class="contentMargin" >
    <div class="container" style="margin-top: 100px;">
        <div class="row rightLeft" id="rightLeft">
            
            <div class="col-md-9" style="margin-bottom: 20px;margin-top:35px;">
                <div class="row">
                    <input type="button" class="addButton" value="ADD" style="margin-bottom: 20px;" onclick="javascript:window.location.href='waterSliceApply.html'">
                    <table class="table table-striped" id="applyTableList">
                    	<tr>
                            <td class="tableTitle tableBorder">Application Time</td>
                            <td class="tableTitle tableBorder">Order No.</td>
                            <td class="tableTitle tableBorder">Deliver Status</td>
                            <td class="tableTitle tableBorder" >Deliver Time</td>
                            <td class="tableTitle tableBorder" >Express</td>
                            <td class="tableTitle tableBorder" >Shipping No.</td>
                            <td class="tableTitle tableBorder" >Status</td>
                        </tr>
                    </table>
                </div>
                <!--分页-->
                <div id="Pagination" class="pagination"><!-- 这里显示分页 --></div>
            </div>

        </div>
        <div class="topBottom" id="topBottom">
            
            <div class="row" style="margin-left: 20px;margin-right: 20px;">
                <input type="button" class="addButton" value="ADD" style="margin-bottom: 20px;" onclick="javascript:window.location.href='waterSliceApply.html'">
                <table class="table table-striped" id="sTable">
                    <!-- <tr>
                        <td class="tableTitle tableBorder" style="width: 120px;">申请时间</td>
                        <td class="tableContent">2018-01-29</td>
                    </tr>
                    <tr>
                        <td class="tableTitle tableBorder">订单号</td>
                        <td class="tableContent">12345678910</td>
                    </tr>
                    <tr>
                        <td class="tableTitle tableBorder">发货状态</td>
                        <td class="tableContent">待发货</td>
                    </tr>
                    <tr>
                        <td class="tableTitle tableBorder" >发货时间</td>
                        <td class="tableContent">2020-01-29</td>
                    </tr>
                    <tr>
                        <td class="tableTitle tableBorder" >物流公司</td>
                        <td class="tableContent">联邦普运</td>
                    </tr>
                    <tr>
                        <td class="tableTitle tableBorder" >物流单号</td>
                        <td class="tableContent">8013 4815 0597</td>
                    </tr>
                    <tr>
                        <td class="tableTitle tableBorder"  style="border-bottom: solid 1px #D9D9D9;">订单状态</td>
                        <td class="tableContent">已支付</td>
                    </tr>
                    <tr>
                        <td class="tableContent" colspan="2" >
                            <div style="text-align: left;">
                                <span>收货人：</span>
                                <span>Bone：</span>
                                <span>13986457125</span>
                            </div>
                            <div style="text-align: left;">
                                <span>收货地址：</span>
                                <span>厦门市湖里区嘉园路125号809室</span>
                                <div  style="float: right; ">
                                  <img src="../../style/prj/images/delete.png">
                                </div>
                            </div>
                        </td>
                    </tr> -->
                </table>
            </div>
        </div>
    </div>
</div>
<!--第一个商品结束-->
<!-- 内容结束 -->
<!--尾部开始-->
<div id="footerPart">
   
</div>

<script type="text/javascript">
	var initPageIndex = 1;     //页面索引初始值   
	var pageSize = 10;     //每页显示条数初始化，修改显示条数，修改这里即可 
	$().ready(function() {
		initTop();
		initClick();
		initBottom();
		initAccountInfo();
	   //初始化净水片列表 
	   initTableList(initPageIndex,1);
	})
	function initTableList(pageIndex, type){
			//查询是移动端登录还是pc端登录
			if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {  
				pageSize=99;
			}
			joy.getJSON("../../wl/es/wlEsApplyAction.web?action=findDataList",{
				currPage : pageIndex,
				pageSize : pageSize,
				keyId:"memberId",
				lang : "EN"
			},function(resultObject) {	
				$("#applyTableList tr:not(:first)").remove();//数据清空
				$("#sTable tr").remove();//小屏幕数据清空
				if(resultObject.items.length!==0){
					if (type!=0) {
					  pagination(resultObject.totalCount,pageIndex);
					}
				}
				var txt = '';
				var smallTxt = '';
				//刷新收货地址列表
				for ( var i = 0; i < resultObject.items.length; i++) {
					var createTime = '<td class="tableContent">' + resultObject.items[i].createTime + '</td>';
					var orderNo = '<td class="tableContent">' + resultObject.items[i].orderNo + '</td>';
					if(resultObject.items[i].isDeliveryFlag==='0'){
						var isDeliveryFlag = '<td class="tableContent">Unshipped</td>';
					}else{
						var isDeliveryFlag = '<td class="tableContent">Shipped</td>';
					}
					if(resultObject.items[i].deliveryTime ==null){
						var deliveryTime = '<td class="tableContent">' + '</td>';
					}else{
						var deliveryTime = '<td class="tableContent">' + resultObject.items[i].deliveryTime + '</td>';
					}
					var logiSticEkValue = '<td class="tableContent">' + resultObject.items[i].logiSticEkValue + '</td>';
					var deliveryNo = '<td class="tableContent">' + resultObject.items[i].deliveryNo + '</td>';
					var paymentStatusEkValue ="";
					if (resultObject.items[i].paymentStatusEkValue=='Unpaid') {
						paymentStatusEkValue = '<td class="tableContent">' + resultObject.items[i].paymentStatusEkValue + '&nbsp;&nbsp;|&nbsp;&nbsp;<a href="javascript:toPay(\''+resultObject.items[i].orderNo+'\')">GO TO CHECKOUT</a>' + '</td>';
					} else {
						paymentStatusEkValue = '<td class="tableContent">' + resultObject.items[i].paymentStatusEkValue + '</td>';
					}
					var receiver = resultObject.items[i].receiver;
					var mobile = resultObject.items[i].mobile;
					var addr = resultObject.items[i].addr;
					var province = resultObject.items[i].province;
					var city = resultObject.items[i].city;
					var area = resultObject.items[i].area;
					var applyId = resultObject.items[i].applyId;
					
					//大屏幕展现拼接
					txt += '<tr>';
					txt += createTime + orderNo + isDeliveryFlag + deliveryTime + logiSticEkValue + deliveryNo + paymentStatusEkValue;
					txt += '</tr><tr>';
					txt += '<td colspan="7" class="tableBottom">';
					txt += '<div style="float: left">Receiver:&nbsp; ' + receiver + '&nbsp' + mobile + '&nbsp&nbsp&nbspAddress：' + addr +",&nbsp;"+ area +",&nbsp;" + city + ",&nbsp;" + province + '</div>';
					txt += '<div class="text-right"><a href="javascript:delWaterSlice(\'' + applyId + '\')"><img src="../../style/prj/images/delete.png"></a></div>';
					txt += '</td></tr>';
					txt += '<tr><td colspan="7"></td></tr> ';
					
					//小屏幕展现拼接
					smallTxt += '<tr>';
					smallTxt += '<td class="tableTitle tableBorder" style="width: 120px;">Application Time</td>'  + createTime + '</td></tr>';
					smallTxt += '<td class="tableTitle tableBorder">Order No.</td>' + orderNo + '</td></tr>';
					smallTxt += '<td class="tableTitle tableBorder">Deliver Status</td>' + isDeliveryFlag + '</td></tr>';
					smallTxt += '<td class="tableTitle tableBorder" >Deliver Time</td>' + deliveryTime + '</td></tr>';
					smallTxt += '<td class="tableTitle tableBorder" >Express</td>' + logiSticEkValue + '</td></tr>';
					smallTxt += '<td class="tableTitle tableBorder" >Shipping No.</td>' + deliveryNo + '</td></tr>';
					smallTxt += '<td class="tableTitle tableBorder"  style="border-bottom: solid 1px #D9D9D9;">Status</td>' + paymentStatusEkValue + '</td></tr>';
					smallTxt += '<tr>\
	                    <td class="tableContent" colspan="2" >\
		                    <div style="text-align: left;">\
		                        <span>Receiver：</span>\
		                        <span>'+receiver+'</span>\
		                        <span>'+mobile+'</span>\
		                    </div>\
		                    <div style="text-align: left;">\
		                        <span>Address：</span>\
		                        <span>' + addr + ',&nbsp;' + area + ',&nbsp;' + city + ',&nbsp;' + province + '</span>\
		                        <div  style="float: right; ">\
		                        	<a href="javascript:delWaterSlice(\'' + applyId + '\')"><img src="../../style/prj/images/delete.png"></a>\
		                        </div>\
		                    </div>\
		                </td>\
		            </tr>\
		            <tr><td colspan="7"></td></tr>';
				}
				$("#sTable").append(smallTxt);
				$("#applyTableList").append(txt);
			});
	   }

	//去支付
	function toPay(orderNo){
		joy.getJSON("../../wl/es/wlEsApplyAction.web?action=getorderByOrderNo",
		{
			orderNo : orderNo
		}, function(resultObject) {
			if (resultObject.orderStateEk == '4') {
				joy.showMessage("This order is closed", "warning");
				return;
			} else {
				joy.showMessageDialog("Order No.:"+orderNo+"，Checkout now?", "ok,cancel", function(e) {
					if (e.btnName == "ok") {
						window.location="payWay.html?orderId="+resultObject.orderId;
					}
				});
				$(".k-window-title").text("Prompt");
				   $(".k-message-ok").text("Confirm");
				   $(".k-message-cancel").text("Cancel");
			}
		});
	}
	//删除记录
	function delWaterSlice(applyId){
		joy.showMessageDialog("Are you sure to remove this order?", "ok,cancel", function(e) {
			if (e.btnName == "ok") {	
				joy.getJSON(
					"../../wl/es/wlEsApplyAction.web?action=deleteData",
					{
						applyId : applyId
					}, function(resultObject) {
						joy.showMessage("Success", "success");
						initTableList(initPageIndex);
					});
			}
		});
		$(".k-window-title").text("Prompt");
		   $(".k-message-ok").text("Confirm");
		   $(".k-message-cancel").text("Cancel");
	}
	//分页展现
	function pagination(totalCount,pageIndex){
		$("#Pagination").html("");
		var pageCount = 1;
		 if(totalCount > 0){
			pageCount = Math.ceil(totalCount/pageSize);
		 }
		var initPagination = function() {
			// 创建分页
			$("#Pagination").pagination(pageCount, {
				num_edge_entries: 1, //边缘页数
				num_display_entries: 4, //主体页数
				callback: pageselectCallback,
				items_per_page:1, //每页显示1项
				prev_text:"&laquo;",
				next_text:"&raquo;",
				current_page:pageIndex-1
			});
		 }();
		 
		function pageselectCallback(page_index, jq){
			initTableList(page_index+1, 0);
			var idx = parseInt(page_index);
			$("[name='pageSelect']").val(idx);
			return false;
		}
		
		$("#Pagination").next().remove();
		var paginationText = '<div class="text-center" style="float:right;margin-top:26px;font-size: 16px;"><span style="margin-right: 5px;">Total&nbsp;&nbsp;'+pageCount+'&nbsp;page,</span>'+
        '<span style="margin-right: 5px;">go to<select name="pageSelect" >';
        for(var i = 0;i < pageCount; i++){
        	if (i==parseInt(pageIndex-1)) {
        		paginationText +='<option value="'+(i)+'" selected>'+(i+1)+'</option>';	
        	} else {
        		paginationText +='<option value="'+(i)+'">'+(i+1)+'</option>';
        	}
        	 //paginationText +='<option value="'+(i)+'">'+(i+1)+'</option>';
        }
        paginationText +=' </select>page</span>'+
        '<input type="button" class="sureAndBack" value="Confirm" onclick="reflashPage($(this))"/></div>';
		$("#Pagination").after(paginationText);
	 }
	//刷新页面操作
  	function reflashPage(){
		var pnum = parseInt($("[name='pageSelect']").val());
		initTableList(pnum+1,1);
  	} 
</script>
</body>
</html>