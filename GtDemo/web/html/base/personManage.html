<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8">
	<script src="../../js/jquery.min.js"></script>
    <script src="../../js/joy.loader.js" modules="form,dataview"></script>    
</head>
<body>
 	 
	<!-- 工具栏 -->
    <div class="k-page-toolbar"> 
    	<button class="joy-button joy-smc" icon="plus" onClick="openAddWindow"  dataBind="visible:addSmc" label="lgc:add"></button>  
        <button class="joy-button joy-smc" icon="close" onClick="deleteData"  dataBind="visible:deleteSmc" label="lgc:delete"></button>
        
        <div id="searchForm" class="joy-form" style="float:right" layout="horizontal">
		   <input  class="joy-textbox" label="lg:name" placeholder="请选择..."  style="width:180px" dataBind="value:name"/>
		   <button class="joy-button" icon="search" onClick="searchData" label="lgc:search"></button>
		</div> 
    </div>
    
     <!-- 列表 -->  
   	<table id="grid"  class="joy-grid" pageSize = "10" height="525px"  >   
          <thead>  
              <tr>
              	<th field="id" templateType="checkbox" colWidth="40px" ></th>
                  <th field="name" dataType="string" label="lg:name" colWidth="100"></th> 
                  <th field="sex" enumData="sexEnum" label="lg:sex" align="center"  colWidth="70px" dataType="string" ></th>
                  <th field="deptId" dataType="string" label="lg:deptId" enumData="deptIdEnum" colWidth="100"></th>  
                  <th field="birthday" dataFormat="yyyy-M-d" label="lg:birthday" dataType="date"  colWidth="100"></th>
                  <th field="age" dataFormat="n0"  dataType="number" label="lg:age" colWidth="70px"></th>
                  <th field="tel"  dataType="string" label="lg:tel" colWidth="100"></th>
                  <th field="hobby"  dataType="string" label="lg:hobby" enumData="hobbyEnum"  colWidth="100"></th>
                  <th field="identityCard"  dataType="string" label="lg:identityCard" colWidth="200px"></th>                  
                  <th colWidth="190px" templateType="button"  label="lg:control" >
						<button icon="pencil" onClick="openEditWindow('#:id#')"  smcBind="editSmc" label="lgc:edit"  ></button>  
						<button icon="insert-m" onClick="openDetailWindow('#:id#')" smcBind="deleteSmc" label="lgc:detail" ></button>			
				  </th>
               </tr> 
          </thead>
    </table>  
        	
    
    
    
    <!-- 编辑框 -->
    <div id="editWindow" class="joy-window" width="680px" style="padding:10px 20px;" center="true" title="lg:windowTitle">
    	<form id="dataForm" class="joy-form" >
    	  <input type="hidden" databind="value:id">
		  <table cellspacing=1 cellpadding=3 width="100%" align="center" border=0>
		    <tbody>		      
		      <tr > 
		        <td width="340px" height="25"  align=left >
		          <input class="joy-textbox" label="lg:name" placeholder="请输入..." required="true"  maxByte="20" databind="value:name">
	            </td>
		        <td align=left>
	              <input class="joy-combobox joy-enum" placeholder="请选择..." label="lg:sex"  required="true" databind="value:sex,source:sexEnum">
				  </td>
	          </tr>	  
		      <tr >
		        <td  align=left>
	            <input class="joy-datepicker"  label="lg:birthday" required="true" placeholder="请输入..." databind="value:birthday"></td>
		        <td align=left>
	            <input class="joy-datepicker"  label="lg:graduateYear" required="true" placeholder="请输入..."  depth="year" databind="value:graduateYear"></td>
	          </tr>		      
		      <tr > 
		        <td align="left">
                  <input class="joy-datepicker"  label="lg:joinWorkMonth"  depth="month"  placeholder="请输入..." databind="value:joinWorkMonth">
		       </td>
		        <td align="left">
                  <input class="joy-timepicker"  label="lg:applyTime" required="true" placeholder="请输入..." databind="value:applyTime">
		        </td>
	          </tr>		  
	          <tr > 
		        <td align="left">
                  <input class="joy-datetimepicker"  label="lg:registerDateTime" required="true" placeholder="请输入..."  databind="value:registerDateTime">
		       </td>
		        <td align="left">
                  <input class="joy-numerictextbox"  label="lg:age" placeholder="请输入..." dataType="+int" databind="value:age">
		        </td>
	          </tr>		
	          <tr > 
		        <td align="left">
                  <input class="joy-multiselect joy-enum" placeholder="请输入..." style="width:22.4em" label="lg:hobby" databind="value:hobby,source:hobbyEnum">
		       </td>
		        <td align="left">
                  <input class="joy-textbox"  label="lg:identityCard" placeholder="请输入..." databind="value:identityCard">
		        </td>
	          </tr>		
	          <tr > 
		        <td align="left">
                  <input class="joy-combobox joy-enum"  label="lg:deptId"  placeholder="请输入..." databind="value:deptId,source:deptIdEnum">
		       </td>
		       
		        <td align="left">
                  <input class="joy-textbox"  label="lg:tel" placeholder="请输入..." databind="value:tel">
		        </td>
	          </tr>	   
	          <tr > 	       
		        <td align="left" colspan=2>
                  <textarea class="joy-textarea" required="true"  placeholder="请输入..." style="width:630px" label="lg:explain"  databind="value:explain"></textarea>
		        </td>
	          </tr>	   
		    </tbody>
		  </table>
		  <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="margin-top: 6px;">
		    <tr> 
		      <td align="right" valign="bottom"> 
		      		<button class="joy-button" btnType="importantbtn" icon="tick" onClick="saveData" label="lgc:save"></button> 
		      		<button class="joy-button  joy-window-close" icon="cancel" label="lgc:cancel"></button>  
		      </td>
		    </tr>
		  </table>
		</form>   
    </div>
    
    <!-- 详细框 -->
    <div id="detailWindow" class="joy-window" width="800px" style="padding:10px 20px;" center="true" align="left" title="lg:windowTitle">
    	  <div class="joy-lang k-info-title" style="width:100%" label="lgc:baseInfo"></div>    		 
		  <table id="detailTable"  width="100%" align="center" class="k-info-table"  border="0" cellspacing="0" cellpadding="0"> 
		    <tbody>		      
		      <tr height="25">
		        <td width="120"  class="joy-lang head" label="lg:name"></td> 
		        <td width="280" class="joy-label" databind="value:name"></td>
		        <td width="120" class="joy-lang head" label="lg:sex"></td>
		        <td width="280" class="joy-label joy-enum" databind="value:sex,source:sexEnum"></td>
	          </tr>			
	          <tr height="25">
		        <td class="joy-lang head" label="lg:birthday"></td> 
		        <td class="joy-label" databind="value:birthday"></td>
		        <td class="joy-lang head" label="lg:graduateYear"></td>
		        <td class="joy-label" databind="value:graduateYear"></td>
	          </tr>	
	          <tr height="25">
		        <td class="joy-lang head" label="lg:joinWorkMonth"></td> 
		        <td class="joy-label" databind="value:joinWorkMonth"></td>
		        <td class="joy-lang head" label="lg:applyTime"></td>
		        <td class="joy-label" databind="value:applyTime"></td>
	          </tr>	
	              <tr height="25">
		        <td class="joy-lang head" label="lg:registerDateTime"></td> 
		        <td class="joy-label"  databind="value:registerDateTime"></td>
		        <td class="joy-lang head" label="lg:age"></td>
		        <td class="joy-label" databind="value:age"></td>
	          </tr>	
	          <tr height="25">
		        <td class="joy-lang head" label="lg:hobby"></td> 
		        <td class="joy-label joy-enum" databind="value:hobby,source:hobbyEnum"></td>
		        <td class="joy-lang head" label="lg:identityCard"></td>
		        <td class="joy-label" databind="value:identityCard"></td>
	          </tr>	
	          <tr height="25">
		        <td class="joy-lang head" label="lg:deptId"></td> 
		        <td class="joy-label  joy-enum" databind="value:deptId,source:deptIdEnum"></td>
		        <td class="joy-lang head" label="lg:tel"></td>
		        <td class="joy-label" databind="value:tel"></td>
	          </tr>		
	          <tr height="25">
		        <td class="joy-lang head" label="lg:explain"></td> 
		        <td class="joy-label" databind="value:explain" colspan=3></td>		        
	          </tr>	 	          
		    </tbody>
		  </table>		 
		  <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0"  style="margin-top: 6px;">
		    <tr> 
		      <td  align="right" valign="bottom"> 
		      		<button class="joy-button joy-window-close" icon="cancel" label="lgc:close"></button>  
		      </td>
		    </tr>
		  </table> 
    </div>
    
    
    
</body>
<script>

var dataForm,searchForm,editWindow,detailWindow,grid,initResult,lgc,lg;
var searchUrl = "basePersonAction.do?action=findDataList";    

$().ready(function(){	
	lgc=joy.getCommonLang();
	lg=joy.getLang();
	grid = $("#grid").getJoyGrid();
	dataForm=$("#dataForm").getJoyForm();
	searchForm=$("#searchForm").getJoyForm();
	editWindow=$("#editWindow").getJoyWindow();	
	detailWindow=$("#detailWindow").getJoyWindow();
	
	//数据初始化
	joy.getJSON("basePersonAction.do?action=init", function(resultObject){
		 initResult = resultObject;	 
		 var viewModel = joy.observable(initResult); 
		 joy.bind($(".joy-smc,.joy-enum"), viewModel);	 
		 grid.fetch(initResult,searchUrl); 
	});	
})

/**
 * 打开新增窗体
 */
function openAddWindow(){	
	dataForm.load();	
	editWindow.open();	
}

/**
 * 打开编辑窗体
 */
function openEditWindow(id){	
	joy.getJSON("basePersonAction.do?action=getDataObject",{id:id}, function(resultObject){			
		dataForm.load(resultObject);		
		editWindow.open();			 
	});		
}

/**
 * 保存数据
 */
function saveData(buttonObject){
	//设置按钮不可用，防止重复提交
	buttonObject.enable(false);
	if (!dataForm.validate()){
		joy.showMessage(lgc.validateFaile,"warning");
		buttonObject.enable(true);
		return;
	}	
	dataForm.submit("basePersonAction.do?action=saveData",buttonObject,function(resultObject){
		editWindow.close();	
		grid.dataSource.fetch();
		joy.showMessage(lgc.opSuccess,"success");
	});	
}
 
/**
 * 打开详细窗体
 */
function openDetailWindow(id){
	 
	joy.getJSON("basePersonAction.do?action=getDataObject",{id:id}, function(resultObject){	
		var viewModel = joy.observable(resultObject); 
		joy.bind($("#detailTable"), viewModel);			
		detailWindow.open();	 
	});	
} 

/**
 * 删除数据
 */
function deleteData(){  	
	var ids =  grid.getChecked();  
	if (ids.length==0){
		joy.showMessage(lgc.chooseRecord,"warning");
	}
	else{
		joy.showMessageDialog(lgc.deleteConfirm,"ok,cancel",function(e){
			if(e.btnName=="ok"){ 
				joy.getJSON("basePersonAction.do?action=deleteData",{ids:ids}, function(resultObject){             		
            		grid.dataSource.fetch()
            		joy.showMessage(lgc.opSuccess,"success"); 
            	});
			}
		});
	}
}

/**
 * 搜索数据
 */
function searchData(){	
	grid.fetch(initResult,searchUrl, searchForm.getDataModel().toJSON());
}
</script>
</html>
